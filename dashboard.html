<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Accomplishments Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        :root {
            --bg: #0f172a;
            --bg-card: #0b1220;
            --bg-glass: rgba(255,255,255,0.03);
            --bg-glass-hover: rgba(255,255,255,0.06);
            --border: rgba(255,255,255,0.04);
            --text: #e6eef8;
            --text-muted: #94a3b8;
            --text-dim: #64748b;
            --accent: #7c3aed;
            --accent-light: #a78bfa;
            --green: #22c55e;
            --green-dim: rgba(34, 197, 94, 0.15);
            --blue: #3b82f6;
            --blue-dim: rgba(59, 130, 246, 0.15);
            --yellow: #eab308;
            --yellow-dim: rgba(234, 179, 8, 0.15);
            --orange: #f97316;
            --red: #ef4444;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --cyan: #06b6d4;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            min-height: 100%;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(180deg, #071029 0%, #071b2a 100%);
            color: var(--text);
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 28px 24px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .sub {
            color: var(--text-muted);
            font-size: 13px;
        }

        .date-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-nav button {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .date-nav button:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        .date-nav input {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
        }

        .topnav {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .topnav a {
            color: var(--accent-light);
            text-decoration: none;
        }

        .topnav a:hover {
            text-decoration: underline;
        }

        /* Main Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Sidebar Snapshot */
        .snapshot {
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .snapshot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .big-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--green);
        }

        .big-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .snapshot-stats {
            text-align: right;
        }

        .snapshot-stat {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
            margin-bottom: 4px;
        }

        .snapshot-stat .num {
            font-weight: 600;
            font-size: 18px;
        }

        .snapshot-stat .lbl {
            font-size: 12px;
            color: var(--text-muted);
        }

        .kpis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 16px 0;
        }

        .kpi {
            background: var(--bg-glass);
            padding: 12px;
            border-radius: 8px;
        }

        .kpi-val {
            font-weight: 600;
            font-size: 15px;
        }

        .kpi-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .snapshot-list {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .snapshot-list h3 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-muted);
        }

        .snapshot-list ul {
            list-style: none;
            padding: 0;
        }

        .snapshot-list li {
            font-size: 13px;
            color: var(--text-muted);
            padding: 6px 0;
            border-bottom: 1px solid var(--border);
        }

        .snapshot-list li:last-child {
            border-bottom: none;
        }

        .snapshot-list strong {
            color: var(--text);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        /* Cards Grid */
        .cards-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        @media (max-width: 768px) {
            .cards-row {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-glass);
            padding: 18px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .card h2 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-full {
            grid-column: 1 / -1;
        }

        /* Chart containers */
        .chart-wrapper {
            position: relative;
            height: 200px;
            background: #fff;
            border-radius: 8px;
            padding: 10px;
        }

        .chart-wrapper canvas {
            max-height: 100%;
        }

        /* SVG charts (from generate_reports.py) */
        img.chart-svg {
            width: 100%;
            height: auto;
            border-radius: 8px;
            background: #fff;
            padding: 8px;
        }

        /* Downloads */
        .downloads {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-block;
            padding: 8px 12px;
            background: linear-gradient(90deg, var(--accent), #5b21b6);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-glass);
            border: 1px solid var(--border);
        }

        /* Summary Section */
        .summary-content {
            color: #dbeafe;
        }

        .summary-content h3 {
            font-size: 15px;
            margin-bottom: 12px;
        }

        .summary-content ul {
            margin: 0;
            padding-left: 20px;
        }

        .summary-content li {
            margin: 8px 0;
            font-size: 13px;
            line-height: 1.6;
        }

        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .data-table th {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 12px;
        }

        .data-table tr:hover td {
            background: var(--bg-glass);
        }

        .domain-bar {
            height: 6px;
            background: var(--accent);
            border-radius: 3px;
            transition: width 0.5s ease-out;
        }

        /* Appointments & Meetings */
        .event-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .event-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: var(--bg-glass);
            border-radius: 8px;
            border-left: 3px solid var(--green);
        }

        .event-item.meeting {
            border-left-color: var(--blue);
        }

        .event-icon {
            font-size: 20px;
        }

        .event-details {
            flex: 1;
        }

        .event-name {
            font-weight: 500;
            font-size: 14px;
        }

        .event-time {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .event-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
        }

        .badge-solid { background: var(--green-dim); color: var(--green); }
        .badge-likely { background: var(--yellow-dim); color: var(--yellow); }
        .badge-meeting { background: var(--blue-dim); color: var(--blue); }

        /* Top Apps List */
        .app-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .app-row:last-child {
            border-bottom: none;
        }

        .app-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: var(--bg-glass);
        }

        .app-info {
            flex: 1;
        }

        .app-name {
            font-size: 13px;
            font-weight: 500;
        }

        .app-bar-container {
            height: 4px;
            background: var(--bg-glass);
            border-radius: 2px;
            margin-top: 4px;
            overflow: hidden;
        }

        .app-bar {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease-out;
        }

        .app-time {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
        }

        /* Category Pills */
        .category-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
        }

        .category-name {
            width: 100px;
            font-size: 13px;
            font-weight: 500;
        }

        .category-bar-container {
            flex: 1;
            height: 20px;
            background: var(--bg-glass);
            border-radius: 4px;
            overflow: hidden;
        }

        .category-bar {
            height: 100%;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 11px;
            font-weight: 500;
            color: white;
            transition: width 0.5s ease-out;
        }

        .category-time {
            font-size: 13px;
            font-weight: 600;
            width: 50px;
            text-align: right;
        }

        /* Hourly Focus Grid */
        .hourly-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 4px;
        }

        .hour-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .hour-cell:hover {
            transform: scale(1.1);
            z-index: 1;
        }

        .hour-cell .h {
            color: var(--text-muted);
            font-size: 9px;
        }

        .hour-cell .t {
            font-weight: 600;
            font-size: 11px;
        }

        /* Top Pages & Windows */
        .page-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .page-item:last-child {
            border-bottom: none;
        }

        .page-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding-right: 12px;
        }

        .page-visits {
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Next Actions */
        .next-action {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--bg-glass);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .next-action::before {
            content: '‚Üí';
            color: var(--accent);
            font-weight: bold;
        }

        /* Footer */
        footer {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 13px;
        }

        footer a {
            color: #9ae6b4;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Loading & Error States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            font-size: 16px;
            color: var(--text-muted);
        }

        .loading::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            margin-right: 12px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--red);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            color: var(--red);
        }

        /* Accomplishments List */
        .accomplishment-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .accomplishment-item:last-child {
            border-bottom: none;
        }

        .accomplishment-item::before {
            content: '‚úì';
            color: var(--green);
            font-weight: bold;
        }

        /* Google Workspace */
        .gws-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 13px;
        }

        .gws-icon {
            width: 24px;
            text-align: center;
        }

        /* Notes */
        .note-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            color: var(--text-muted);
        }

        .note-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Daily Accomplishments</h1>
                <div class="sub" id="headerSub">Loading...</div>
                <nav class="topnav">
                    <a href="./">All Reports</a> ¬∑ 
                    <a href="#" id="jsonLink">Raw JSON</a> ¬∑ 
                    <a href="#" id="summaryLink">Summary</a>
                </nav>
            </div>
            <div style="text-align: right;">
                <div class="date-nav">
                    <button id="prevDay">‚Üê Prev</button>
                    <input type="date" id="dateInput">
                    <button id="nextDay">Next ‚Üí</button>
                </div>
            </div>
        </header>

        <div id="dashboard">
            <div class="loading">Loading dashboard...</div>
        </div>

        <footer id="footer">
            Files: Loading...
        </footer>
    </div>

    <script>
        // State - default to 2025-12-01 if no data for today
        let currentDate = '2025-12-01';
        let data = null;

        // DOM
        const dashboard = document.getElementById('dashboard');
        const dateInput = document.getElementById('dateInput');
        const prevDay = document.getElementById('prevDay');
        const nextDay = document.getElementById('nextDay');
        const headerSub = document.getElementById('headerSub');
        const jsonLink = document.getElementById('jsonLink');
        const summaryLink = document.getElementById('summaryLink');
        const footer = document.getElementById('footer');

        // Init - try today first, fallback to 2025-12-01
        async function init() {
            const today = new Date().toISOString().split('T')[0];
            // Try today's data first
            try {
                const resp = await fetch(`ActivityReport-${today}.json`, { method: 'HEAD' });
                if (resp.ok) {
                    currentDate = today;
                }
            } catch (e) {
                // Use default date
            }
            dateInput.value = currentDate;
            loadData(currentDate);
        }
        init();

        // Events
        dateInput.addEventListener('change', (e) => {
            currentDate = e.target.value;
            loadData(currentDate);
        });

        prevDay.addEventListener('click', () => {
            const date = new Date(currentDate);
            date.setDate(date.getDate() - 1);
            currentDate = date.toISOString().split('T')[0];
            dateInput.value = currentDate;
            loadData(currentDate);
        });

        nextDay.addEventListener('click', () => {
            const date = new Date(currentDate);
            date.setDate(date.getDate() + 1);
            currentDate = date.toISOString().split('T')[0];
            dateInput.value = currentDate;
            loadData(currentDate);
        });

        async function loadData(date) {
            dashboard.innerHTML = '<div class="loading">Loading dashboard...</div>';

            try {
                // Try ActivityReport format first (the rich format)
                let response = await fetch(`ActivityReport-${date}.json`);
                
                if (!response.ok) {
                    // Try reports folder
                    response = await fetch(`reports/daily-report-${date}.json`);
                }
                
                if (!response.ok) {
                    throw new Error('Report not found');
                }

                data = await response.json();
                
                // Update header
                const coverage = data.overview?.coverage_window || 'Unknown';
                headerSub.textContent = `Report date: ${date} ‚Äî Coverage: ${coverage}`;
                jsonLink.href = `ActivityReport-${date}.json`;
                summaryLink.href = `SUMMARY-${date}.md`;
                
                // Update footer
                footer.innerHTML = `Files: <a href="ActivityReport-${date}.json">ActivityReport-${date}.json</a> ¬∑ <a href="SUMMARY-${date}.md">SUMMARY-${date}.md</a>`;
                
                renderDashboard(data);
            } catch (error) {
                console.error('Failed to load:', error);
                dashboard.innerHTML = `
                    <div class="error">
                        <h3>üì≠ No report found for ${date}</h3>
                        <p style="margin-top: 12px; color: var(--text-muted);">
                            Try selecting a different date or check if data collection is running.
                        </p>
                    </div>
                `;
                headerSub.textContent = `Report date: ${date} ‚Äî No data`;
            }
        }

        function renderDashboard(d) {
            const focusTime = d.overview?.focus_time || '00:00';
            const meetingsTime = d.overview?.meetings_time || '00:00';
            const appointments = d.overview?.appointments || 0;
            const meetings = d.debug_appointments?.meetings_today?.length || 0;
            const coverage = d.overview?.coverage_window || 'Unknown';
            
            // Get top domain
            const topDomain = d.browser_highlights?.top_domains?.[0] || { domain: 'N/A', visits: 0 };
            
            // Get top project
            const projects = d.by_project || {};
            const topProject = Object.entries(projects).sort((a, b) => timeToMinutes(b[1]) - timeToMinutes(a[1]))[0];
            
            // Get top apps
            const apps = d.top_apps || {};
            const topApps = Object.entries(apps).slice(0, 3);
            
            // Hourly peak
            const hourlyPeak = d.hourly_focus?.reduce((max, h) => 
                timeToMinutes(h.time) > timeToMinutes(max.time) ? h : max, 
                { hour: 0, time: '00:00' }
            ) || { hour: 0, time: '00:00' };

            dashboard.innerHTML = `
                <div class="main-grid">
                    <!-- Sidebar Snapshot -->
                    <aside>
                        <div class="snapshot">
                            <div class="snapshot-header">
                                <div>
                                    <div class="big-number">${focusTime}</div>
                                    <div class="big-label">Total Focused Time</div>
                                </div>
                                <div class="snapshot-stats">
                                    <div class="snapshot-stat">
                                        <span class="num">${meetings}</span>
                                        <span class="lbl">Meeting${meetings !== 1 ? 's' : ''}</span>
                                    </div>
                                    <div class="snapshot-stat">
                                        <span class="num">${appointments}</span>
                                        <span class="lbl">Appointment${appointments !== 1 ? 's' : ''}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="kpis">
                                <div class="kpi">
                                    <div class="kpi-val">${topDomain.visits}</div>
                                    <div class="kpi-label">Top domain (${topDomain.domain})</div>
                                </div>
                                <div class="kpi">
                                    <div class="kpi-val">${topProject ? topProject[0] : 'N/A'}</div>
                                    <div class="kpi-label">Top project${topProject ? ` (${topProject[1]})` : ''}</div>
                                </div>
                            </div>

                            <div class="snapshot-list">
                                <h3>üìä Quick Stats</h3>
                                <ul>
                                    <li><strong>Top Apps:</strong> ${topApps.map(([n, t]) => `${n} (${t})`).join(', ') || 'N/A'}</li>
                                    <li><strong>Hourly Peak:</strong> ${hourlyPeak.hour}:00 (${hourlyPeak.time} focused)</li>
                                    <li><strong>Meetings:</strong> ${meetingsTime}</li>
                                    <li><strong>Coverage:</strong> ${coverage}</li>
                                </ul>
                            </div>

                            ${d.debug_appointments?.appointments_today?.length ? `
                            <div class="snapshot-list">
                                <h3>üìÖ Appointments</h3>
                                <ul>
                                    ${d.debug_appointments.appointments_today.map(a => 
                                        `<li><strong>${a.name}</strong> ‚Äî ${a.time}</li>`
                                    ).join('')}
                                </ul>
                            </div>
                            ` : ''}
                        </div>
                    </aside>

                    <!-- Main Content -->
                    <main class="main-content">
                        <!-- Charts Row -->
                        <div class="cards-row">
                            <div class="card">
                                <h2>üìà Hourly Focus</h2>
                                <img class="chart-svg" src="hourly_focus.svg" alt="Hourly focus chart" 
                                     onerror="this.parentElement.querySelector('.chart-wrapper').style.display='block';this.style.display='none';">
                                <div class="chart-wrapper" style="display:none;">
                                    <canvas id="hourlyChart"></canvas>
                                </div>
                                <div class="downloads">
                                    <a class="btn" href="hourly_focus.csv">Download CSV</a>
                                    <a class="btn btn-secondary" href="hourly_focus.svg">Download SVG</a>
                                </div>
                            </div>

                            <div class="card">
                                <h2>ü•ß Category Distribution</h2>
                                <img class="chart-svg" src="category_distribution.svg" alt="Category distribution" 
                                     onerror="this.parentElement.querySelector('.chart-wrapper').style.display='block';this.style.display='none';">
                                <div class="chart-wrapper" style="display:none;">
                                    <canvas id="categoryChart"></canvas>
                                </div>
                                <div class="downloads">
                                    <a class="btn" href="category_distribution.csv">Download CSV</a>
                                </div>
                            </div>
                        </div>

                        <!-- Top Domains -->
                        <div class="card">
                            <h2>üåê Top Domains</h2>
                            ${renderTopDomains(d.browser_highlights?.top_domains || [])}
                            <div class="downloads">
                                <a class="btn" href="top_domains.csv">Download CSV</a>
                            </div>
                        </div>

                        <!-- Categories Breakdown -->
                        <div class="card">
                            <h2>üìä Time by Category</h2>
                            ${renderCategories(d.by_category || {})}
                        </div>

                        <!-- Top Apps -->
                        <div class="card">
                            <h2>üíª Top Applications</h2>
                            ${renderTopApps(d.top_apps || {})}
                        </div>

                        <!-- Meetings & Appointments -->
                        <div class="cards-row">
                            <div class="card">
                                <h2>üìÖ Meetings Today</h2>
                                ${renderMeetings(d.debug_appointments?.meetings_today || [])}
                            </div>

                            <div class="card">
                                <h2>ü§ù Appointments Set</h2>
                                ${renderAppointments(d.debug_appointments?.appointments_today || [])}
                            </div>
                        </div>

                        <!-- Hourly Heatmap -->
                        <div class="card">
                            <h2>üî• Hourly Activity Heatmap</h2>
                            ${renderHourlyHeatmap(d.hourly_focus || [])}
                        </div>

                        <!-- Top Windows -->
                        <div class="card">
                            <h2>ü™ü Top Windows</h2>
                            ${renderTopWindows(d.top_windows_preview || [])}
                        </div>

                        <!-- Top Pages -->
                        <div class="card">
                            <h2>üìÑ Top Pages Visited</h2>
                            ${renderTopPages(d.browser_highlights?.top_pages || [])}
                        </div>

                        <!-- Google Workspace -->
                        ${d.google_workspace ? `
                        <div class="card">
                            <h2>üìé Google Workspace</h2>
                            ${renderGoogleWorkspace(d.google_workspace)}
                        </div>
                        ` : ''}

                        <!-- Projects -->
                        <div class="card">
                            <h2>üìÅ Projects</h2>
                            ${renderProjects(d.by_project || {})}
                        </div>

                        <!-- Summary -->
                        <div class="card">
                            <h2>üìù Summary</h2>
                            <div class="summary-content">
                                <h3>Daily Accomplishments ‚Äî ${d.date || currentDate}</h3>
                                <ul>
                                    <li><strong>Total Focused Time:</strong> ${focusTime} (Coverage: ${coverage})</li>
                                    <li><strong>Meetings:</strong> ${meetings} ‚Äî ${d.debug_appointments?.meetings_today?.map(m => `${m.name} (${m.time})`).join('; ') || 'None'}</li>
                                    <li><strong>Appointments:</strong> ${appointments} ‚Äî ${d.debug_appointments?.appointments_today?.map(a => a.name).join('; ') || 'None'}</li>
                                    <li><strong>Top Activity (domains):</strong> ${(d.browser_highlights?.top_domains || []).slice(0, 3).map(d => `${d.domain} (${d.visits})`).join('; ')}</li>
                                    <li><strong>Top Apps:</strong> ${topApps.map(([n, t]) => `${n} (${t})`).join('; ')}</li>
                                    <li><strong>Hourly Peak:</strong> ${hourlyPeak.hour}:00 (${hourlyPeak.time} focused)</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Next Actions -->
                        ${d.next_up?.length ? `
                        <div class="card">
                            <h2>‚û°Ô∏è Next Actions</h2>
                            ${d.next_up.map(action => `<div class="next-action">${action}</div>`).join('')}
                        </div>
                        ` : ''}

                        <!-- Accomplishments -->
                        ${d.accomplishments_today?.length ? `
                        <div class="card">
                            <h2>‚úÖ Accomplishments</h2>
                            ${d.accomplishments_today.map(a => `<div class="accomplishment-item">${a}</div>`).join('')}
                        </div>
                        ` : ''}

                        <!-- Executive Summary -->
                        ${d.executive_summary?.length ? `
                        <div class="card">
                            <h2>üìã Executive Summary</h2>
                            <ul style="margin: 0; padding-left: 20px;">
                                ${d.executive_summary.map(s => `<li style="margin: 8px 0; font-size: 13px;">${s}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}

                        <!-- Manager Summary -->
                        ${d.prepared_for_manager?.length ? `
                        <div class="card">
                            <h2>üëî Prepared for Manager</h2>
                            <ul style="margin: 0; padding-left: 20px;">
                                ${d.prepared_for_manager.map(s => `<li style="margin: 8px 0; font-size: 13px;">${s}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}

                        <!-- Notes -->
                        ${d.notes?.length ? `
                        <div class="card">
                            <h2>üìù Notes</h2>
                            ${d.notes.map(n => `<div class="note-item">${n}</div>`).join('')}
                        </div>
                        ` : ''}

                        <!-- Suggested Tasks -->
                        ${d.suggested_tasks?.length ? `
                        <div class="card">
                            <h2>üí° Suggested Tasks</h2>
                            ${d.suggested_tasks.map(t => `<div class="note-item">${t}</div>`).join('')}
                        </div>
                        ` : ''}
                    </main>
                </div>
            `;

            // Render fallback charts if SVGs don't load
            setTimeout(() => {
                if (document.getElementById('hourlyChart')?.parentElement.style.display === 'block') {
                    renderHourlyChart(d.hourly_focus || []);
                }
                if (document.getElementById('categoryChart')?.parentElement.style.display === 'block') {
                    renderCategoryChart(d.by_category || {});
                }
            }, 100);
        }

        function renderTopDomains(domains) {
            if (!domains.length) return '<p style="color: var(--text-muted);">No domain data</p>';
            const max = domains[0]?.visits || 1;
            
            return `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th>Domain</th>
                            <th style="width: 80px;">Visits</th>
                            <th style="width: 200px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        ${domains.slice(0, 10).map((d, i) => `
                            <tr>
                                <td>${i + 1}</td>
                                <td>${d.domain}</td>
                                <td>${d.visits}</td>
                                <td>
                                    <div class="domain-bar" style="width: ${(d.visits / max) * 100}%;"></div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderCategories(categories) {
            const entries = Object.entries(categories);
            if (!entries.length) return '<p style="color: var(--text-muted);">No category data</p>';
            
            const colors = ['#22c55e', '#3b82f6', '#8b5cf6', '#eab308', '#f97316', '#ec4899'];
            const maxMinutes = Math.max(...entries.map(([, t]) => timeToMinutes(t)), 1);
            
            return entries.map(([name, time], i) => {
                const minutes = timeToMinutes(time);
                const pct = (minutes / maxMinutes) * 100;
                const color = colors[i % colors.length];
                
                return `
                    <div class="category-row">
                        <div class="category-name">${name}</div>
                        <div class="category-bar-container">
                            <div class="category-bar" style="width: ${pct}%; background: ${color};">${name}</div>
                        </div>
                        <div class="category-time">${time}</div>
                    </div>
                `;
            }).join('');
        }

        function renderTopApps(apps) {
            const entries = Object.entries(apps);
            if (!entries.length) return '<p style="color: var(--text-muted);">No app data</p>';
            
            const icons = {
                'Google Chrome': 'üåê',
                'Terminal': '‚å®Ô∏è',
                'VS Code': 'üíª',
                'Code': 'üíª',
                'Slack': 'üí¨',
                'Messages': 'üí¨',
                'Finder': 'üìÅ',
                'Safari': 'üß≠',
                'Mail': 'üìß',
                'Calendar': 'üìÖ',
                'Notes': 'üìù',
                'Preview': 'üñºÔ∏è',
                'System Preferences': '‚öôÔ∏è',
                'TextEdit': 'üìÑ',
                'App Store': 'üõçÔ∏è',
            };
            
            const colors = ['#22c55e', '#3b82f6', '#8b5cf6', '#eab308', '#f97316', '#ec4899', '#06b6d4', '#f43f5e'];
            const maxMinutes = Math.max(...entries.map(([, t]) => timeToMinutes(t)), 1);
            
            return entries.slice(0, 8).map(([name, time], i) => {
                const minutes = timeToMinutes(time);
                const pct = (minutes / maxMinutes) * 100;
                const icon = icons[name] || 'üì±';
                const color = colors[i % colors.length];
                
                return `
                    <div class="app-row">
                        <div class="app-icon">${icon}</div>
                        <div class="app-info">
                            <div class="app-name">${name}</div>
                            <div class="app-bar-container">
                                <div class="app-bar" style="width: ${pct}%; background: ${color};"></div>
                            </div>
                        </div>
                        <div class="app-time">${time}</div>
                    </div>
                `;
            }).join('');
        }

        function renderMeetings(meetings) {
            if (!meetings.length) return '<p style="color: var(--text-muted);">No meetings scheduled</p>';
            
            return `
                <div class="event-list">
                    ${meetings.map(m => `
                        <div class="event-item meeting">
                            <div class="event-icon">üìÖ</div>
                            <div class="event-details">
                                <div class="event-name">${m.name}</div>
                                <div class="event-time">${m.time}</div>
                            </div>
                            <span class="event-badge badge-meeting">Meeting</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderAppointments(appointments) {
            if (!appointments.length) return '<p style="color: var(--text-muted);">No appointments set</p>';
            
            return `
                <div class="event-list">
                    ${appointments.map(a => `
                        <div class="event-item">
                            <div class="event-icon">ü§ù</div>
                            <div class="event-details">
                                <div class="event-name">${a.name}</div>
                                <div class="event-time">${a.time}</div>
                            </div>
                            <span class="event-badge badge-solid">Set</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderHourlyHeatmap(hourly) {
            if (!hourly.length) return '<p style="color: var(--text-muted);">No hourly data</p>';
            
            // Filter to working hours (6am - 11pm)
            const workHours = hourly.filter(h => h.hour >= 6 && h.hour <= 22);
            const maxMinutes = Math.max(...workHours.map(h => timeToMinutes(h.time)), 1);
            
            return `
                <div class="hourly-grid">
                    ${workHours.map(h => {
                        const minutes = timeToMinutes(h.time);
                        const intensity = minutes / maxMinutes;
                        const bg = intensity > 0 
                            ? `rgba(34, 197, 94, ${0.2 + intensity * 0.8})`
                            : 'rgba(255,255,255,0.03)';
                        const textColor = intensity > 0.5 ? '#fff' : 'var(--text-muted)';
                        
                        return `
                            <div class="hour-cell" style="background: ${bg};" title="${h.hour}:00 - ${h.time}">
                                <span class="h">${h.hour}</span>
                                <span class="t" style="color: ${textColor}">${h.time}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderTopWindows(windows) {
            if (!windows.length) return '<p style="color: var(--text-muted);">No window data</p>';
            
            return windows.slice(0, 10).map(w => `
                <div class="page-item">
                    <div class="page-title">${w}</div>
                </div>
            `).join('');
        }

        function renderTopPages(pages) {
            if (!pages.length) return '<p style="color: var(--text-muted);">No page data</p>';
            
            return pages.slice(0, 10).map(p => `
                <div class="page-item">
                    <div class="page-title">${p.page}</div>
                    <div class="page-visits">${p.visits} visits</div>
                </div>
            `).join('');
        }

        function renderGoogleWorkspace(gws) {
            const icons = {
                'Google': 'üîç',
                'Google Sheets': 'üìä',
                'Google Calendar': 'üìÖ',
                'Gmail': 'üìß',
                'Google Drive': 'üìÅ',
                'Google Docs': 'üìÑ',
            };
            
            const entries = Object.entries(gws).filter(([k]) => k !== 'top_documents');
            const docs = gws.top_documents || [];
            
            return `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="font-size: 13px; color: var(--text-muted); margin-bottom: 10px;">Usage</h4>
                        ${entries.map(([name, time]) => `
                            <div class="gws-item">
                                <div class="gws-icon">${icons[name] || 'üìé'}</div>
                                <div style="flex: 1;">${name}</div>
                                <div style="color: var(--text-muted);">${time}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h4 style="font-size: 13px; color: var(--text-muted); margin-bottom: 10px;">Top Documents</h4>
                        ${docs.slice(0, 5).map(d => `
                            <div style="font-size: 13px; padding: 6px 0; border-bottom: 1px solid var(--border);">
                                ${d}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderProjects(projects) {
            const entries = Object.entries(projects).filter(([, t]) => t !== '00:00');
            if (!entries.length) return '<p style="color: var(--text-muted);">No project data</p>';
            
            const maxMinutes = Math.max(...entries.map(([, t]) => timeToMinutes(t)), 1);
            
            return `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th style="width: 80px;">Time</th>
                            <th style="width: 150px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        ${entries.slice(0, 10).map(([name, time]) => `
                            <tr>
                                <td>${name}</td>
                                <td>${time}</td>
                                <td>
                                    <div class="domain-bar" style="width: ${(timeToMinutes(time) / maxMinutes) * 100}%; background: var(--purple);"></div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderHourlyChart(hourly) {
            const ctx = document.getElementById('hourlyChart');
            if (!ctx) return;

            const labels = hourly.filter(h => h.hour >= 6 && h.hour <= 22).map(h => `${h.hour}:00`);
            const values = hourly.filter(h => h.hour >= 6 && h.hour <= 22).map(h => timeToMinutes(h.time));

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Focus (min)',
                        data: values,
                        backgroundColor: values.map(v => {
                            if (v >= 45) return 'rgba(34, 197, 94, 0.8)';
                            if (v >= 30) return 'rgba(234, 179, 8, 0.8)';
                            if (v > 0) return 'rgba(59, 130, 246, 0.8)';
                            return 'rgba(100, 116, 139, 0.3)';
                        }),
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 60 },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function renderCategoryChart(categories) {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;

            const labels = Object.keys(categories);
            const values = Object.values(categories).map(timeToMinutes);

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(234, 179, 8, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                        ],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Utilities
        function timeToMinutes(timeStr) {
            if (!timeStr || timeStr === '00:00') return 0;
            const parts = timeStr.split(':');
            if (parts.length === 2) {
                return parseInt(parts[0]) * 60 + parseInt(parts[1]);
            }
            return 0;
        }
    </script>
</body>
</html>
