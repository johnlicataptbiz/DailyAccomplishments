<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Accomplishments Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            --bg-card-hover: linear-gradient(135deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%);
            --border: rgba(255,255,255,0.06);
            --border-glow: rgba(139, 92, 246, 0.3);
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --text-dim: #64748b;
            
            /* Gradient accents */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --gradient-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-purple: linear-gradient(135deg, #8b5cf6 0%, #d946ef 100%);
            --gradient-orange: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-blue: linear-gradient(135deg, #0061ff 0%, #60efff 100%);
            
            --green: #10b981;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --cyan: #06b6d4;
            --orange: #f97316;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            background-image: 
                radial-gradient(ellipse at 20% 0%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 100%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 0% 50%, rgba(236, 72, 153, 0.08) 0%, transparent 40%);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 32px 40px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        header h1 {
            font-size: 26px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sub {
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 400;
            margin-top: 2px;
        }

        .topnav {
            font-size: 13px;
            color: var(--text-dim);
            margin-top: 6px;
        }

        .topnav a {
            color: var(--purple);
            text-decoration: none;
            transition: all 0.2s;
        }

        .topnav a:hover {
            color: var(--pink);
        }

        .date-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .date-nav button {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 10px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .date-nav button:hover {
            background: var(--gradient-primary);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        .date-nav button.today-btn {
            background: var(--gradient-success);
            border: none;
            box-shadow: 0 4px 16px rgba(17, 153, 142, 0.3);
        }

        .date-nav button.today-btn:hover {
            box-shadow: 0 8px 32px rgba(56, 239, 125, 0.4);
        }

        .date-nav input {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 13px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .date-nav input:focus {
            outline: none;
            border-color: var(--purple);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        /* Stats Hero */
        .stats-hero {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 28px;
        }

        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 20px 20px 0 0;
        }

        .stat-card:nth-child(1)::before { background: var(--gradient-success); }
        .stat-card:nth-child(2)::before { background: var(--gradient-info); }
        .stat-card:nth-child(3)::before { background: var(--gradient-purple); }
        .stat-card:nth-child(4)::before { background: var(--gradient-warning); }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--border-glow);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-bottom: 16px;
        }

        .stat-card:nth-child(1) .stat-icon { background: linear-gradient(135deg, rgba(17, 153, 142, 0.2), rgba(56, 239, 125, 0.1)); }
        .stat-card:nth-child(2) .stat-icon { background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.1)); }
        .stat-card:nth-child(3) .stat-icon { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(217, 70, 239, 0.1)); }
        .stat-card:nth-child(4) .stat-icon { background: linear-gradient(135deg, rgba(240, 147, 251, 0.2), rgba(245, 87, 108, 0.1)); }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 4px;
        }

        .stat-card:nth-child(1) .stat-value { background: var(--gradient-success); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-card:nth-child(2) .stat-value { background: var(--gradient-info); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-card:nth-child(3) .stat-value { background: var(--gradient-purple); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-card:nth-child(4) .stat-value { background: var(--gradient-warning); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1200px) {
            .stats-hero { grid-template-columns: repeat(2, 1fr); }
            .main-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .stats-hero { grid-template-columns: 1fr; }
            .container { padding: 20px; }
            header { flex-direction: column; gap: 20px; text-align: center; }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(139, 92, 246, 0.2);
        }

        .card-full {
            grid-column: 1 / -1;
        }

        .card h2 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text);
        }

        .card h2 .icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* Chart containers */
        .chart-wrapper {
            position: relative;
            height: 220px;
            background: rgba(255,255,255,0.02);
            border-radius: 16px;
            padding: 16px;
        }

        /* Downloads */
        .downloads {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            background: var(--gradient-primary);
            color: white;
            border-radius: 10px;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.05);
            box-shadow: none;
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
            box-shadow: none;
        }

        /* Category bars */
        .category-row {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .category-row:last-child { border-bottom: none; }

        .category-name {
            width: 110px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .category-bar-container {
            flex: 1;
            height: 28px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            overflow: hidden;
        }

        .category-bar {
            height: 100%;
            display: flex;
            align-items: center;
            padding-left: 12px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            border-radius: 8px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .category-time {
            font-size: 14px;
            font-weight: 600;
            width: 55px;
            text-align: right;
            color: var(--text-muted);
        }

        /* Top Apps */
        .app-row {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .app-row:last-child { border-bottom: none; }

        .app-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: var(--gradient-primary);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .app-info { flex: 1; }

        .app-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .app-bar-container {
            height: 6px;
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
            overflow: hidden;
        }

        .app-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .app-time {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-muted);
        }

        /* Domain table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 14px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 13px;
        }

        .data-table th {
            color: var(--text-dim);
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tr:hover td {
            background: rgba(255,255,255,0.02);
        }

        .domain-bar {
            height: 8px;
            border-radius: 4px;
            transition: width 0.6s ease-out;
        }

        /* Events */
        .event-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .event-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            background: rgba(255,255,255,0.02);
            border-radius: 14px;
            border-left: 3px solid;
            transition: all 0.3s;
        }

        .event-item:hover {
            background: rgba(255,255,255,0.04);
            transform: translateX(4px);
        }

        .event-item.meeting { border-left-color: var(--blue); }
        .event-item.appointment { border-left-color: var(--green); }

        .event-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .event-item.meeting .event-icon { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(6, 182, 212, 0.1)); }
        .event-item.appointment .event-icon { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(56, 239, 125, 0.1)); }

        .event-details { flex: 1; }
        .event-name { font-weight: 500; font-size: 14px; }
        .event-time { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

        .event-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-meeting { background: rgba(59, 130, 246, 0.15); color: var(--blue); }
        .badge-set { background: rgba(16, 185, 129, 0.15); color: var(--green); }

        /* Hourly Heatmap */
        .hourly-grid {
            display: grid;
            grid-template-columns: repeat(17, 1fr);
            gap: 6px;
        }

        .hour-cell {
            aspect-ratio: 1;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .hour-cell:hover {
            transform: scale(1.15);
            z-index: 10;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .hour-cell .h { color: var(--text-dim); font-size: 10px; font-weight: 500; }
        .hour-cell .t { font-weight: 700; font-size: 12px; margin-top: 2px; }

        /* Page items */
        .page-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 13px;
        }

        .page-item:last-child { border-bottom: none; }

        .page-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding-right: 16px;
            color: var(--text);
        }

        .page-visits {
            color: var(--text-muted);
            font-weight: 600;
            font-size: 12px;
            background: rgba(255,255,255,0.05);
            padding: 4px 10px;
            border-radius: 6px;
        }

        /* Summary */
        .summary-content ul {
            list-style: none;
            padding: 0;
        }

        .summary-content li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 14px;
            line-height: 1.7;
        }

        .summary-content li:last-child { border-bottom: none; }

        .summary-content strong {
            color: var(--purple);
        }

        /* Accomplishments */
        .accomplishment-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 14px;
        }

        .accomplishment-item::before {
            content: '‚úì';
            color: var(--green);
            font-weight: bold;
            background: rgba(16, 185, 129, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* Footer */
        footer {
            margin-top: 48px;
            padding: 32px 0;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-dim);
            font-size: 13px;
        }

        footer a {
            color: var(--purple);
            text-decoration: none;
            transition: color 0.2s;
        }

        footer a:hover { color: var(--pink); }

        .creator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .creator-badge {
            background: var(--gradient-primary);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        /* Loading & Error States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            font-size: 16px;
            color: var(--text-muted);
        }

        .loading::before {
            content: '';
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--purple);
            border-radius: 50%;
            margin-right: 14px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 20px;
            padding: 48px;
            text-align: center;
        }

        .error h3 { color: #f87171; font-size: 20px; margin-bottom: 12px; }
        .error p { color: var(--text-muted); }

        /* Note items */
        .note-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 13px;
            color: var(--text-muted);
        }

        .note-item:last-child { border-bottom: none; }

        /* GWS */
        .gws-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            font-size: 14px;
        }

        .gws-icon {
            width: 28px;
            text-align: center;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="brand">
                <div class="logo">üìä</div>
                <div>
                    <h1>Daily Accomplishments</h1>
                    <div class="sub" id="headerSub">Loading...</div>
                    <nav class="topnav">
                        <a href="./">All Reports</a> ¬∑ 
                        <a href="#" id="jsonLink">Raw JSON</a> ¬∑ 
                        <a href="#" id="summaryLink">Summary</a>
                    </nav>
                </div>
            </div>
            <div class="date-nav">
                <button id="prevDay">‚Üê Prev</button>
                <input type="date" id="dateInput">
                <button id="nextDay">Next ‚Üí</button>
                <button id="todayBtn" class="today-btn">Today</button>
            </div>
        </header>

        <div id="dashboard">
            <div class="loading">Loading dashboard...</div>
        </div>

        <footer>
            <div id="footer">Files: Loading...</div>
            <div class="creator">
                <span>Created by</span>
                <span class="creator-badge">Jack Licata</span>
            </div>
        </footer>
    </div>

    <script>
        // State - default to today's date
        let currentDate = new Date().toISOString().split('T')[0];
        let data = null;
        let hourlyChartInstance = null;
        let categoryChartInstance = null;

        // DOM
        const dashboard = document.getElementById('dashboard');
        const dateInput = document.getElementById('dateInput');
        const prevDay = document.getElementById('prevDay');
        const nextDay = document.getElementById('nextDay');
        const todayBtn = document.getElementById('todayBtn');
        const headerSub = document.getElementById('headerSub');
        const jsonLink = document.getElementById('jsonLink');
        const summaryLink = document.getElementById('summaryLink');
        const footer = document.getElementById('footer');

        // Init
        dateInput.value = currentDate;
        loadData(currentDate);

        // Events
        dateInput.addEventListener('change', (e) => {
            currentDate = e.target.value;
            loadData(currentDate);
        });

        prevDay.addEventListener('click', () => {
            const date = new Date(currentDate);
            date.setDate(date.getDate() - 1);
            currentDate = date.toISOString().split('T')[0];
            dateInput.value = currentDate;
            loadData(currentDate);
        });

        nextDay.addEventListener('click', () => {
            const date = new Date(currentDate);
            date.setDate(date.getDate() + 1);
            currentDate = date.toISOString().split('T')[0];
            dateInput.value = currentDate;
            loadData(currentDate);
        });

        todayBtn.addEventListener('click', () => {
            currentDate = new Date().toISOString().split('T')[0];
            dateInput.value = currentDate;
            loadData(currentDate);
        });

        async function loadData(date) {
            dashboard.innerHTML = '<div class="loading">Loading dashboard...</div>';

            try {
                // Try ActivityReport format first (the rich format)
                let response = await fetch(`ActivityReport-${date}.json`);
                
                if (!response.ok) {
                    // Try reports folder
                    response = await fetch(`reports/daily-report-${date}.json`);
                }
                
                if (!response.ok) {
                    throw new Error('Report not found');
                }

                data = await response.json();
                
                // Update header
                const coverage = data.overview?.coverage_window || 'Unknown';
                headerSub.textContent = `Report date: ${date} ‚Äî Coverage: ${coverage}`;
                jsonLink.href = `ActivityReport-${date}.json`;
                summaryLink.href = `SUMMARY-${date}.md`;
                
                // Update footer
                footer.innerHTML = `Files: <a href="ActivityReport-${date}.json">ActivityReport-${date}.json</a> ¬∑ <a href="SUMMARY-${date}.md">SUMMARY-${date}.md</a>`;
                
                renderDashboard(data);
            } catch (error) {
                console.error('Failed to load:', error);
                dashboard.innerHTML = `
                    <div class="error">
                        <h3>üì≠ No report found for ${date}</h3>
                        <p style="margin-top: 12px; color: var(--text-muted);">
                            Try selecting a different date or check if data collection is running.
                        </p>
                    </div>
                `;
                headerSub.textContent = `Report date: ${date} ‚Äî No data`;
            }
        }

        function renderDashboard(d) {
            const focusTime = d.overview?.focus_time || '00:00';
            const meetingsTime = d.overview?.meetings_time || '00:00';
            const appointments = d.overview?.appointments || 0;
            const meetings = d.debug_appointments?.meetings_today?.length || 0;
            const coverage = d.overview?.coverage_window || 'Unknown';
            
            // Get top domain
            const topDomain = d.browser_highlights?.top_domains?.[0] || { domain: 'N/A', visits: 0 };
            
            // Get top project
            const projects = d.by_project || {};
            const topProject = Object.entries(projects).sort((a, b) => timeToMinutes(b[1]) - timeToMinutes(a[1]))[0];
            
            // Get top apps
            const apps = d.top_apps || {};
            const topApps = Object.entries(apps).slice(0, 3);
            
            // Hourly peak
            const hourlyPeak = d.hourly_focus?.reduce((max, h) => 
                timeToMinutes(h.time) > timeToMinutes(max.time) ? h : max, 
                { hour: 0, time: '00:00' }
            ) || { hour: 0, time: '00:00' };

            dashboard.innerHTML = `
                <!-- Stats Hero Cards -->
                <div class="stats-hero">
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-value">${focusTime}</div>
                        <div class="stat-label">Total Focus Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-value">${meetings}</div>
                        <div class="stat-label">Meetings (${meetingsTime})</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ü§ù</div>
                        <div class="stat-value">${appointments}</div>
                        <div class="stat-label">Appointments Set</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üåê</div>
                        <div class="stat-value">${topDomain.visits}</div>
                        <div class="stat-label">Top: ${topDomain.domain}</div>
                    </div>
                </div>

                <!-- Main Grid -->
                <div class="main-grid">
                    <!-- Charts -->
                    <div class="card">
                        <h2><span class="icon">üìà</span> Hourly Focus</h2>
                        <div class="chart-wrapper">
                            <canvas id="hourlyChart"></canvas>
                        </div>
                        <div class="downloads">
                            <a class="btn" href="hourly_focus.csv">üì• Download CSV</a>
                        </div>
                    </div>

                    <div class="card">
                        <h2><span class="icon">ü•ß</span> Category Distribution</h2>
                        <div class="chart-wrapper">
                            <canvas id="categoryChart"></canvas>
                        </div>
                        <div class="downloads">
                            <a class="btn" href="category_distribution.csv">üì• Download CSV</a>
                        </div>
                    </div>

                    <!-- Time by Category -->
                    <div class="card">
                        <h2><span class="icon">üìä</span> Time by Category</h2>
                        ${renderCategories(d.by_category || {})}
                    </div>

                    <!-- Top Apps -->
                    <div class="card">
                        <h2><span class="icon">üíª</span> Top Applications</h2>
                        ${renderTopApps(d.top_apps || {})}
                    </div>

                    <!-- Top Domains -->
                    <div class="card card-full">
                        <h2><span class="icon">üåê</span> Top Domains</h2>
                        ${renderTopDomains(d.browser_highlights?.top_domains || [])}
                    </div>

                    <!-- Meetings & Appointments -->
                    <div class="card">
                        <h2><span class="icon">üìÖ</span> Meetings Today</h2>
                        ${renderMeetings(d.debug_appointments?.meetings_today || [])}
                    </div>

                    <div class="card">
                        <h2><span class="icon">ü§ù</span> Appointments Set</h2>
                        ${renderAppointments(d.debug_appointments?.appointments_today || [])}
                    </div>

                    <!-- Hourly Heatmap -->
                    <div class="card card-full">
                        <h2><span class="icon">üî•</span> Hourly Activity Heatmap</h2>
                        ${renderHourlyHeatmap(d.hourly_focus || [])}
                    </div>

                    <!-- Top Windows -->
                    <div class="card">
                        <h2><span class="icon">ü™ü</span> Top Windows</h2>
                        ${renderTopWindows(d.top_windows_preview || [])}
                    </div>

                    <!-- Top Pages -->
                    <div class="card">
                        <h2><span class="icon">üìÑ</span> Top Pages</h2>
                        ${renderTopPages(d.browser_highlights?.top_pages || [])}
                    </div>

                    <!-- Summary -->
                    <div class="card card-full">
                        <h2><span class="icon">üìù</span> Daily Summary</h2>
                        <div class="summary-content">
                            <ul>
                                <li><strong>Focus:</strong> ${focusTime} (${coverage})</li>
                                <li><strong>Peak Hour:</strong> ${hourlyPeak.hour}:00 with ${hourlyPeak.time} focused</li>
                                <li><strong>Top Apps:</strong> ${topApps.map(([n, t]) => `${n} (${t})`).join(', ') || 'N/A'}</li>
                                <li><strong>Meetings:</strong> ${meetings} ‚Äî ${d.debug_appointments?.meetings_today?.map(m => `${m.name} (${m.time})`).join('; ') || 'None'}</li>
                                <li><strong>Appointments:</strong> ${appointments} ‚Äî ${d.debug_appointments?.appointments_today?.map(a => a.name).join('; ') || 'None'}</li>
                            </ul>
                        </div>
                    </div>

                    ${d.accomplishments_today?.length ? `
                    <div class="card card-full">
                        <h2><span class="icon">‚úÖ</span> Accomplishments</h2>
                        ${d.accomplishments_today.slice(0, 8).map(a => `<div class="accomplishment-item">${a}</div>`).join('')}
                    </div>
                    ` : ''}

                    ${d.executive_summary?.length ? `
                    <div class="card">
                        <h2><span class="icon">üìã</span> Executive Summary</h2>
                        <ul style="margin: 0; padding-left: 20px;">
                            ${d.executive_summary.map(s => `<li style="margin: 8px 0; font-size: 13px;">${s}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}

                    ${d.next_up?.length ? `
                    <div class="card">
                        <h2><span class="icon">‚û°Ô∏è</span> Next Actions</h2>
                        ${d.next_up.map(action => `<div class="note-item" style="padding-left: 16px; border-left: 2px solid var(--purple);">${action}</div>`).join('')}
                    </div>
                    ` : ''}
                </div>
            `;

            // Render Chart.js charts
            setTimeout(() => {
                renderHourlyChart(d.hourly_focus || []);
                renderCategoryChart(d.by_category || {});
            }, 100);
        }

        function renderTopDomains(domains) {
            if (!domains.length) return '<p style="color: var(--text-muted);">No domain data</p>';
            const max = domains[0]?.visits || 1;
            
            return `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th>Domain</th>
                            <th style="width: 80px;">Visits</th>
                            <th style="width: 200px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        ${domains.slice(0, 10).map((d, i) => `
                            <tr>
                                <td>${i + 1}</td>
                                <td>${d.domain}</td>
                                <td>${d.visits}</td>
                                <td>
                                    <div class="domain-bar" style="width: ${(d.visits / max) * 100}%; background: var(--gradient-primary);"></div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderCategories(categories) {
            const entries = Object.entries(categories);
            if (!entries.length) return '<p style="color: var(--text-muted);">No category data</p>';
            
            const gradients = [
                'linear-gradient(135deg, #11998e, #38ef7d)',
                'linear-gradient(135deg, #4facfe, #00f2fe)',
                'linear-gradient(135deg, #8b5cf6, #d946ef)',
                'linear-gradient(135deg, #f093fb, #f5576c)',
                'linear-gradient(135deg, #fa709a, #fee140)',
                'linear-gradient(135deg, #667eea, #764ba2)'
            ];
            const maxMinutes = Math.max(...entries.map(([, t]) => timeToMinutes(t)), 1);
            
            return entries.map(([name, time], i) => {
                const minutes = timeToMinutes(time);
                const pct = (minutes / maxMinutes) * 100;
                const gradient = gradients[i % gradients.length];
                
                return `
                    <div class="category-row">
                        <div class="category-name">${name}</div>
                        <div class="category-bar-container">
                            <div class="category-bar" style="width: ${pct}%; background: ${gradient};">${name}</div>
                        </div>
                        <div class="category-time">${time}</div>
                    </div>
                `;
            }).join('');
        }

        function renderTopApps(apps) {
            const entries = Object.entries(apps);
            if (!entries.length) return '<p style="color: var(--text-muted);">No app data</p>';
            
            const icons = {
                'Google Chrome': 'üåê',
                'Terminal': '‚å®Ô∏è',
                'VS Code': 'üíª',
                'Code': 'üíª',
                'Slack': 'üí¨',
                'Messages': 'üí¨',
                'Finder': 'üìÅ',
                'Safari': 'üß≠',
                'Mail': 'üìß',
                'Calendar': 'üìÖ',
                'Notes': 'üìù',
                'Preview': 'üñºÔ∏è',
                'System Preferences': '‚öôÔ∏è',
                'TextEdit': 'üìÑ',
                'App Store': 'üõçÔ∏è',
            };
            
            const gradients = [
                'linear-gradient(135deg, #11998e, #38ef7d)',
                'linear-gradient(135deg, #4facfe, #00f2fe)',
                'linear-gradient(135deg, #8b5cf6, #d946ef)',
                'linear-gradient(135deg, #f093fb, #f5576c)',
                'linear-gradient(135deg, #fa709a, #fee140)',
                'linear-gradient(135deg, #667eea, #764ba2)',
                'linear-gradient(135deg, #06b6d4, #3b82f6)',
                'linear-gradient(135deg, #f43f5e, #ec4899)'
            ];
            const maxMinutes = Math.max(...entries.map(([, t]) => timeToMinutes(t)), 1);
            
            return entries.slice(0, 8).map(([name, time], i) => {
                const minutes = timeToMinutes(time);
                const pct = (minutes / maxMinutes) * 100;
                const icon = icons[name] || 'üì±';
                const gradient = gradients[i % gradients.length];
                
                return `
                    <div class="app-row">
                        <div class="app-icon" style="background: ${gradient};">${icon}</div>
                        <div class="app-info">
                            <div class="app-name">${name}</div>
                            <div class="app-bar-container">
                                <div class="app-bar" style="width: ${pct}%; background: ${gradient};"></div>
                            </div>
                        </div>
                        <div class="app-time">${time}</div>
                    </div>
                `;
            }).join('');
        }

        function renderMeetings(meetings) {
            if (!meetings.length) return '<p style="color: var(--text-muted);">No meetings scheduled</p>';
            
            return `
                <div class="event-list">
                    ${meetings.map(m => `
                        <div class="event-item meeting">
                            <div class="event-icon">üìÖ</div>
                            <div class="event-details">
                                <div class="event-name">${m.name}</div>
                                <div class="event-time">${m.time}</div>
                            </div>
                            <span class="event-badge badge-meeting">Meeting</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderAppointments(appointments) {
            if (!appointments.length) return '<p style="color: var(--text-muted);">No appointments set</p>';
            
            return `
                <div class="event-list">
                    ${appointments.map(a => `
                        <div class="event-item appointment">
                            <div class="event-icon">ü§ù</div>
                            <div class="event-details">
                                <div class="event-name">${a.name}</div>
                                <div class="event-time">${a.time}</div>
                            </div>
                            <span class="event-badge badge-set">Set</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderHourlyHeatmap(hourly) {
            if (!hourly.length) return '<p style="color: var(--text-muted);">No hourly data</p>';
            
            // Filter to working hours (6am - 10pm)
            const workHours = hourly.filter(h => h.hour >= 6 && h.hour <= 22);
            const maxMinutes = Math.max(...workHours.map(h => timeToMinutes(h.time)), 1);
            
            return `
                <div class="hourly-grid">
                    ${workHours.map(h => {
                        const minutes = timeToMinutes(h.time);
                        const intensity = minutes / maxMinutes;
                        // Use gradient colors based on intensity
                        let bg;
                        if (intensity === 0) {
                            bg = 'rgba(255,255,255,0.03)';
                        } else if (intensity < 0.3) {
                            bg = `linear-gradient(135deg, rgba(79, 172, 254, ${0.3 + intensity}), rgba(0, 242, 254, ${0.2 + intensity}))`;
                        } else if (intensity < 0.7) {
                            bg = `linear-gradient(135deg, rgba(139, 92, 246, ${0.4 + intensity * 0.6}), rgba(217, 70, 239, ${0.3 + intensity * 0.6}))`;
                        } else {
                            bg = `linear-gradient(135deg, rgba(17, 153, 142, ${0.5 + intensity * 0.5}), rgba(56, 239, 125, ${0.4 + intensity * 0.6}))`;
                        }
                        const textColor = intensity > 0.3 ? '#fff' : 'var(--text-muted)';
                        
                        return `
                            <div class="hour-cell" style="background: ${bg};" title="${h.hour}:00 - ${h.time}">
                                <span class="h">${h.hour}</span>
                                <span class="t" style="color: ${textColor}">${h.time}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderTopWindows(windows) {
            if (!windows.length) return '<p style="color: var(--text-muted);">No window data</p>';
            
            return windows.slice(0, 10).map(w => `
                <div class="page-item">
                    <div class="page-title">${w}</div>
                </div>
            `).join('');
        }

        function renderTopPages(pages) {
            if (!pages.length) return '<p style="color: var(--text-muted);">No page data</p>';
            
            return pages.slice(0, 10).map(p => `
                <div class="page-item">
                    <div class="page-title">${p.page}</div>
                    <div class="page-visits">${p.visits} visits</div>
                </div>
            `).join('');
        }

        function renderGoogleWorkspace(gws) {
            const icons = {
                'Google': 'üîç',
                'Google Sheets': 'üìä',
                'Google Calendar': 'üìÖ',
                'Gmail': 'üìß',
                'Google Drive': 'üìÅ',
                'Google Docs': 'üìÑ',
            };
            
            const entries = Object.entries(gws).filter(([k]) => k !== 'top_documents');
            const docs = gws.top_documents || [];
            
            return `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="font-size: 13px; color: var(--text-muted); margin-bottom: 10px;">Usage</h4>
                        ${entries.map(([name, time]) => `
                            <div class="gws-item">
                                <div class="gws-icon">${icons[name] || 'üìé'}</div>
                                <div style="flex: 1;">${name}</div>
                                <div style="color: var(--text-muted);">${time}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h4 style="font-size: 13px; color: var(--text-muted); margin-bottom: 10px;">Top Documents</h4>
                        ${docs.slice(0, 5).map(d => `
                            <div style="font-size: 13px; padding: 6px 0; border-bottom: 1px solid var(--border);">
                                ${d}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderProjects(projects) {
            const entries = Object.entries(projects).filter(([, t]) => t !== '00:00');
            if (!entries.length) return '<p style="color: var(--text-muted);">No project data</p>';
            
            const maxMinutes = Math.max(...entries.map(([, t]) => timeToMinutes(t)), 1);
            
            return `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th style="width: 80px;">Time</th>
                            <th style="width: 150px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        ${entries.slice(0, 10).map(([name, time]) => `
                            <tr>
                                <td>${name}</td>
                                <td>${time}</td>
                                <td>
                                    <div class="domain-bar" style="width: ${(timeToMinutes(time) / maxMinutes) * 100}%; background: var(--purple);"></div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderHourlyChart(hourly) {
            const ctx = document.getElementById('hourlyChart');
            if (!ctx) return;

            // Destroy existing chart if any
            if (hourlyChartInstance) {
                hourlyChartInstance.destroy();
            }

            const labels = hourly.filter(h => h.hour >= 6 && h.hour <= 22).map(h => `${h.hour}:00`);
            const values = hourly.filter(h => h.hour >= 6 && h.hour <= 22).map(h => timeToMinutes(h.time));

            hourlyChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Focus (min)',
                        data: values,
                        backgroundColor: values.map(v => {
                            if (v >= 45) return 'rgba(34, 197, 94, 0.8)';
                            if (v >= 30) return 'rgba(234, 179, 8, 0.8)';
                            if (v > 0) return 'rgba(59, 130, 246, 0.8)';
                            return 'rgba(100, 116, 139, 0.3)';
                        }),
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 60 },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function renderCategoryChart(categories) {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;

            // Destroy existing chart if any
            if (categoryChartInstance) {
                categoryChartInstance.destroy();
            }

            const labels = Object.keys(categories);
            const values = Object.values(categories).map(timeToMinutes);

            categoryChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(234, 179, 8, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                        ],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Utilities
        function timeToMinutes(timeStr) {
            if (!timeStr || timeStr === '00:00') return 0;
            const parts = timeStr.split(':');
            if (parts.length === 2) {
                return parseInt(parts[0]) * 60 + parseInt(parts[1]);
            }
            return 0;
        }
    </script>
</body>
</html>
