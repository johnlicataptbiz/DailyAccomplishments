<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Daily Accomplishments — Quick Viewer</title>
  <style>
    body { font-family: system-ui, Arial; margin: 20px; }
    .panel { margin-bottom: 20px; }
    #timeline { width: 100%; height: 120px; border: 1px solid #ddd; }
    .hour { display:inline-block; width:3.8%; height:100%; background:#e6eefc; margin-right:0.2%; }
    .hour.active { background: #2563eb; }
  </style>
</head>
<body>
  <h2>Daily Accomplishments — Quick Viewer</h2>
  <div class="panel">
    <label for="day">Date:</label>
    <input id="day" type="date" value="" />
    <button id="load">Load</button>
  </div>
  <div class="panel">
    <strong>Summary:</strong>
    <div id="summary">No data loaded</div>
  </div>
  <div class="panel">
    <strong>Hourly Focus Timeline (blue = focus minutes)</strong>
    <div id="timeline"></div>
  </div>

  <script>
    const defaultTZ = 'America/Chicago';
    const dayInput = document.getElementById('day');
    const summary = document.getElementById('summary');
    const timeline = document.getElementById('timeline');

    function setToday() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      dayInput.value = `${y}-${m}-${day}`;
    }

    function renderReport(data) {
      summary.innerHTML = '';
      const date = data.date || '—';
      const focus = data.overview?.focus_time || '00:00';
      const meetings = data.overview?.meetings_time || '00:00';
      summary.innerHTML = `<div>Date: ${date}</div><div>Total focus: ${focus}</div><div>Meetings: ${meetings}</div>`;

      // Render hourly timeline
      timeline.innerHTML = '';
      const hf = data.hourly_focus || [];
      for (let i=0;i<24;i++){
        const obj = hf[i] || {hour:i,time:'00:00'};
        const minutes = obj.time.split(':').reduce((a,b)=>a*60+parseInt(b,10),0)/60; // wrong but fine
        const div = document.createElement('div');
        div.className = 'hour';
        // If any minutes > 0, mark active
        const mm = obj.time.split(':');
        const m = parseInt(mm[0]||0,10)*60 + parseInt(mm[1]||0,10);
        if(m>0) div.classList.add('active');
        div.title = `${i}: ${obj.time}`;
        timeline.appendChild(div);
      }
    }

    async function loadFor(dateStr){
      const candidates = [
        `/ActivityReport-${dateStr}.json`,
        `/reports/daily-report-${dateStr}.json`,
        `https://raw.githubusercontent.com/johnlicataptbiz/DailyAccomplishments/main/ActivityReport-${dateStr}.json`
      ];
      let txt = null;
      for(const url of candidates){
        try{
          const res = await fetch(url, {cache:'no-store'});
          if(!res.ok) continue;
          txt = await res.text();
          break;
        }catch(e){ continue; }
      }
      if(!txt) { summary.innerText = 'No report found for ' + dateStr; timeline.innerHTML=''; return; }
      try{
        const data = JSON.parse(txt);
        renderReport(data);
      }catch(e){ summary.innerText = 'Failed to parse report JSON'; }
    }

    document.getElementById('load').addEventListener('click', ()=>{
      const d = dayInput.value;
      if(!d) return alert('Pick a date');
      loadFor(d);
    });

    setToday();
  </script>
</body>
</html>
